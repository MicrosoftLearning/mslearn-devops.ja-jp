---
lab:
  topic: Basic
  title: Azure Repos の Git によるバージョン管理
  description: Azure DevOps の一元化された Git リポジトリと簡単に同期できるローカル Git リポジトリの確立について学びます。 また、Visual Studio Code を使用した Git の分岐とマージのサポートについても学びます。
---

# Azure Repos の Git によるバージョン管理

このラボでは、Azure DevOps の集中型 Git リポジトリと簡単に同期できるローカル Git リポジトリを確立する方法を学びます。 さらに、Git のブランチとマージのサポートについても学びます。 Visual Studio Code を使用しますが、Git 互換クライアントの使用にも同じプロセスが適用されます。

Azure DevOps は、Git と Team Foundation バージョン管理 (TFVC) の 2 種類のバージョン管理をサポートしています。 Git は分散バージョン管理システムであり、各開発者が自分の開発用コンピューター上にソース リポジトリのコピーを持っています。 Git は新しいプロジェクトの既定のバージョン管理プロバイダーであり、TFVC の一元的バージョン管理機能が必要な場合を除き、それを使う必要があります。

学習内容:

- 既存のリポジトリをクローンする
- コミットして作業を保存する
- 変更履歴をレビューする
- Visual Studio Code を使用してブランチを操作する

このラボの所要時間は約 **45** 分です。

## 開始する前に

このラボを終えるには、次のものが必要です。

- **Microsoft Edge** または [Azure DevOps 対応ブラウザー](https://docs.microsoft.com/azure/devops/server/compatibility)。
- Azure DevOps 組織。 まだない場合は、[組織またはプロジェクト コレクションの作成](https://docs.microsoft.com/azure/devops/organizations/accounts/create-organization)に関する記事の手順に従って作成します。
- **Git 2.47.0 以降**:Git をまだインストールしていない場合は、[Git for Windows のダウンロード ページ](https://gitforwindows.org/)に移動し、ダウンロードしてインストールします。
- **Visual Studio Code**: Visual Studio Code をまだインストールしていない場合は、[Visual Studio Code のダウンロード ページ](https://code.visualstudio.com/)に移動し、ダウンロードしてインストールします。
- **Visual Studio C# 拡張機能**:Visual Studio C# 拡張機能をまだインストールしていない場合は、[C# 拡張機能のインストール ページ](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp)に移動してインストールします。

### Azure DevOps 組織を設定する (必要な場合)

Azure DevOps 組織がまだない場合は、次の手順のようにします。

1. プライベート ブラウザー セッションを使って、`https://account.microsoft.com` で新しい**個人用 Microsoft アカウント (MSA)** を取得します (既にお持ちの場合はスキップしてください)。
1. 同じブラウザー セッションを使って、`https://azure.microsoft.com/free` で無料の Azure サブスクリプションにサインアップします (既にお持ちの場合はスキップしてください)。
1. ブラウザーを開き、`https://portal.azure.com` の Azure portal に移動し、Azure portal 画面の上部で **Azure DevOps** を検索します。 表示されたページで、**[Azure DevOps 組織]** を選びます。
1. 次に、**[自分の Azure DevOps 組織]** というラベルの付いたリンクを選ぶか、`https://aex.dev.azure.com` に直接移動します。
1. **[We need a few more details](詳細情報をいくつか入力する必要があります)** ページで、 **[続行]** を選びます。
1. 左側のドロップダウン ボックスで、**Microsoft アカウント**の代わりに **[既定のディレクトリ]** を選びます。
1. [詳細情報をいくつか入力する必要があります] というメッセージが表示されたら、名前、メール アドレス、場所を入力して、**[続行]** を選びます。__
1. **[既定のディレクトリ]** を選んで `https://aex.dev.azure.com` に戻り、青い **[新しい組織の作成]** ボタンを選びます。
1. **[続行]** を選んで "サービス使用条件" を承諾します。__
1. プロンプト ( _[Almost done](ほぼ完了)_ ) が表示されたら、Azure DevOps 組織の名前を既定のままにし (グローバルに一意の名前である必要があります)、一覧から最寄りのホスティング場所を選びます。
1. 新しく作成した組織が **Azure DevOps** で開いたら、左下隅にある **[組織設定]** を選びます。
1. **[組織設定]** 画面で、**[課金情報]** を選びます (この画面を開くには数秒かかります)。
1. **[課金の設定]** を選び、画面の右側で **[Azure サブスクリプション]**、**[保存]** の順に選んでサブスクリプションを組織にリンクします。
1. 画面の上部にリンクされた Azure サブスクリプション ID が表示されたら、**MS Hosted CI/CD** の**有料並列ジョブ**の数を 0 から **1** に変更します。 次に、下部にある **[保存]** を選びます。

   > **注**: **CI/CD 機能を使用する前に数分間待つ**と、新しい設定がバックエンドに反映されます。 それができなかった場合、 _"ホストされた並列処理は購入も許可もされていません"_ というメッセージが依然として表示されます。

1. **[組織の設定]** の **[パイプライン]** セクションに移動して、**[設定]** を選びます。
1. **[クラシック ビルド パイプラインの作成を無効にする]** と **[クラシック リリース パイプラインの作成を無効にする]** を **[オフ]** に切り替えます。
1. **[組織の設定]** で、**[セキュリティ]** セクションに移動して **[ポリシー]** を選びます。
1. **[パブリック プロジェクトを許可します]** を **[オン]** に切り替えます。

### Azure DevOps プロジェクトを作成して構成する (必要な場合)

1. ブラウザーを開き、Azure DevOps 組織に移動します。
1. **[新しいプロジェクト]** オプションを選び、次の設定を使用します。
   - 名前: **eShopOnWeb**
   - 可視性: **プライベート**
   - 詳細設定: バージョン コントロール: **Git**
   - 詳細設定: 作業項目プロセス: **スクラム**
1. **［作成］** を選択します

   ![新しいプロジェクトの作成パネルのスクリーンショット。](media/create-project.png)

### eShopOnWeb Git リポジトリをインポートする (必要な場合)

1. 前に作成した **eShopOnWeb** プロジェクトを開きます。
1. **[Repos] > [ファイル]** を選び、**[リポジトリをインポートする]**、**[インポート]** の順に選びます。
1. **[Git リポジトリをインポートする]** ウィンドウで、URL `https://github.com/MicrosoftLearning/eShopOnWeb.git` を貼り付けて、**[インポート]** を選びます。

   ![リポジトリのインポート パネルのスクリーンショット。](media/import-repo.png)

1. リポジトリは次のように編成されています。

   - **.ado** フォルダーには、Azure DevOps の YAML パイプラインが含まれています。
   - **.devcontainer** フォルダーには、コンテナーを使って開発するためのセットアップが含まれています (VS Code でローカルに、または GitHub Codespaces で)。
   - **.azure** フォルダーには、Bicep & ARM インフラストラクチャがコード テンプレートとして含まれています。
   - **.github** フォルダーには、YAML GitHub ワークフローの定義が含まれています。
   - **src** フォルダーには、ラボ シナリオで使用される .NET 8 Web サイトが含まれています。

1. Web ブラウザーのウィンドウは開いたままにしておきます。
1. **[リポジトリ]、[ブランチ]** に移動します。
1. **メイン** ブランチをポイントし、列の右側にある省略記号を選びます。
1. **[既定のブランチとして設定]** を選びます。

### Git と Visual Studio Code を構成する

1. ラボ コンピューターで、**Visual Studio Code** を開きます。
1. Visual Studio Code のインターフェイスのメイン メニューで、 **[ターミナル \| 新しいターミナル]** を選択して、 **[ターミナル]**  ペインを開きます。
1. **[ターミナル]** ペインの右上隅にあるドロップダウン リストに **1: powershell** が表示されているかどうかを確認して、現在のターミナルが **PowerShell** を実行していることを確認します

   > **注**:現在のターミナル シェルを **PowerShell** に変更するには、**[ターミナル]** ペインの右上隅のドロップダウン リストを選んで、**[既定のシェルの選択]** を選びます。 Visual Studio Code ウィンドウの上部で、使用するターミナル シェルとして **[Windows PowerShell]** を選び、ドロップダウン リストの右側にあるプラス記号を選んで、選んだ既定のシェルで新しいターミナルを開きます。

1. **[ターミナル]** ペインで、以下のコマンドを実行して、資格情報ヘルパーを構成します。

   ```git
   git config --global credential.helper wincred
   ```

1. **[ターミナル]** ペインで、次のコマンドを実行して、Git コミットのユーザー名とメールアドレスを設定します (中括弧内のプレースホルダーをユーザー名とメールアドレスに置き換えます。< 記号と > 記号は排除します)。

   ```git
   git config --global user.name "John Doe"
   git config --global user.email johndoe@example.com
   ```

## 既存のリポジトリを複製する

この演習では、Visual Studio Code を使用して、**eShopOnWeb** リポジトリの**メイン** ブランチに変更をコミットします。

> **注**: **メイン** ブランチは **eShopOnWeb** リポジトリ内の既定のブランチであり、ラボの残りの部分で使用するブランチです。

1. 前の演習で生成した **eShopOnWeb** プロジェクトで Azure DevOps 組織が表示されている Web ブラウザーに切り替えます。
1. Azure DevOps ポータルの垂直ナビゲーション ペインで、**[リポジトリ]** アイコンを選択します。

1. **eShopOnWeb** リポジトリのペインの右上隅にある **[クローン]** を選びます。

   ![Git リポジトリのクローンのスクリーンショット。](media/clone-repo.png)

   > **注**:Git リポジトリのローカル コピーを取得することを_クローン作成_と呼びます。 すべての主流の開発ツールはこれをサポートしており、Azure Repos に接続して、最新のソースをプル ダウンして操作できるようになります。

1. **[リポジトリのクローン]** パネルで、**[HTTPS]** コマンドライン オプションを選び、リポジトリ クローン URL の横にある **[クリップボードにコピー]** ボタンを選びます。

   > **注**:この URL を Git 互換ツールで使用して、コードベースのコピーを取得できます。

1. **[リポジトリのクローン]** パネルを閉じます。
1. ラボ コンピューターで実行されている **Visual Studio Code** に切り替えます。
1. **[表示]** メニュー ヘッダーを選び、ドロップダウン メニューで **[コマンド パレット]** を選びます。

   > **注**:コマンド パレットは、サードパーティの拡張機能として実装されているタスクを含む、さまざまなタスクにアクセスするための簡単で便利な方法を提供します。 キーボード ショートカットの **Ctrl+Shift+P** または **F1** を使用して開くことができます。

1. コマンド パレット プロンプトで、**Git:Clone** コマンドを実行します。

   ![VS Code のコマンド パレットのスクリーンショット。](media/vscode-command.png)

   > **注**:関連するすべてのコマンドを表示するには、**Git** と入力することから始めます。

1. **[リポジトリ URL を提供するか、リポジト リソースを選択する]** テキストボックスで、このタスクの前半でコピーしたリポジトリ クローン URL を貼り付け、**Enter** キーを押します。
1. **[フォルダーの選択]** ダイアログ ボックスで C: ドライブに移動し、**Git** という名前の新しいフォルダーを作成して選んで、**[リポジトリの宛先として選択]** を選びます。
1. プロンプトが表示されたら、Azure DevOps アカウントにログインします。
1. クローン プロセスが完了した後、プロンプトが表示されたら、Visual Studio Code で **[開く]** を選んで、クローンされたリポジトリを開きます。

   > **注**:プロジェクトのロードに関する問題に関して受け取る可能性のある警告は無視してかまいません。 ソリューションはビルドに適した状態ではない可能性がありますが、Git での作業に重点を置くため、プロジェクトのビルドは必要ありません。

## コミットを使用して作業を保存する

ファイルに変更を加えると、Git はその変更をローカル リポジトリに記録します。 ステージングすることにより、コミットする変更を選択できます。 コミットは常にローカル Git リポジトリに対して行われるため、コミットが完全であるか、他のユーザーと共有する準備ができているかを心配する必要はありません。 作業を続けながらコミットを増やし、共有の準備ができたら変更を他の人にプッシュできます。

Git コミットは、次のもので構成されます。

- コミットで変更されたファイル。 Git は、リポジトリ内のすべてのファイル変更の内容をコミットに保持します。 これにより、高速が維持され、インテリジェントなマージが可能になります。
- 親コミットへの参照。 Git は、これらの参照を使用してコード履歴を管理します。
- コミットを説明するメッセージ。 コミットを作成するときに、このメッセージを Git に渡します。 このメッセージを説明的なものにしておくことをお勧めしますが、要点を説明します。

### 変更をコミットする

1. Visual Studio Code ウィンドウの縦型ツール バーの上部にある **[エクスプローラー]** タブを選び、 **/eShopOnWeb/src/Web/Program.cs** ファイルに移動して選びます。 これにより、コンテンツが詳細ペインに自動的に表示されます。
1. 最初の行に次のコメントを追加します。

   ```csharp
   // My first change
   ```

   > **注**:コメントが何であるかは実際には問題ではありません。目標は、変更を加えることだけです。

1. **Ctrl + S** キーを押して、変更を保存します。
1. Visual Studio Code ウィンドウで、**[ソース管理]** タブを選択して、Git が Git リポジトリのローカル クローンにあるファイルへの最新の変更を認識したことを確認します。
1. ペインの上部にあるテキスト ボックスの **[ソース管理]** タブを選択した状態で、コミット メッセージとして「**`My commit`**」と入力し、**Ctrl + Enter** キーを押してローカルでコミットします。

   ![最初のコミットのスクリーンショット。](media/first-commit.png)

1. 変更を自動的にステージングして直接コミットするかどうかを確認するメッセージが表示されたら、**[常に]** を選びます。

   > **注**:**ステージング**については、ラボの後半で説明します。

1. Visual Studio Code ウィンドウの左下隅の **main** ラベルの右側にある、反対方向を指す 2 本の縦矢印と、上向きの矢印の横にある番号 **1** が付いた円の **[変更の同期]** アイコンに注意してください。 アイコンを選び、続けるかどうかを確認するメッセージが表示されたら、**[OK]** を選んで、**origin/main** との間でコミットのプッシュとプルを行います。

### コミットの確認

1. Azure DevOps インターフェイスを表示する Web ブラウザー ウィンドウに切り替えます。
1. Azure DevOps ポータルの垂直ナビゲーション ペインの **[リポジトリ]** セクションで、 **[コミット]** を選択します。
1. コミットがリストの一番上に表示されることを確認します。

   ![ADO リポジトリのコミットのスクリーンショット。](media/ado-commit.png)

### ステージの変更

ステージングの変更により、他のファイルで行われた変更を渡しながら、特定のファイルを選択的にコミットに追加できます。

1. **[Visual Studio Code]** ウィンドウに切り替えます。
1. 開いている **Program.cs** クラスを更新して最初のコメントを次の内容に変更し、ファイルを保存します。

   ```csharp
   //My second change
   ```

1. Visual Studio Code ウィンドウで **[エクスプローラー]** タブに戻り、 **/eShopOnWeb/src/Web/Constants.cs** ファイルに移動して選びます。 これにより、コンテンツが詳細ペインに自動的に表示されます。
1. **Constants.cs** ファイルの 1 行目にコメントを追加し、ファイルを保存します。

   ```csharp
   // My third change
   ```

1. Visual Studio Code ウィンドウで **[ソース管理]** タブに切り替え、**Program.cs** エントリをマウス ポインターでポイントして、そのエントリの右側にあるプラス記号を選びます。

   > **注**: これで **Program.cs** ファイルへの変更のみがステージングされます。**Constants.cs** なしでコミットする準備は完了です。

1. ペインの上部にある **[ソース管理]** タブを選択した状態で、テキスト ボックスにコミット メッセージとして **`Added comments`** と入力します。

   ![ステージングされた変更のスクリーンショット。](media/staged-changes.png)

1. **[ソース管理]** タブの上部にある省略記号を選び、ドロップダウン メニューで **[コミット]** を選んで、カスケード メニューで **[ステージング済みをコミット]** を選びます。
1. Visual Studio Code ウィンドウの左下隅にある **[変更の同期]** ボタンを選んで、コミットされた変更をサーバーと同期します。続けるかどうかを確認するメッセージが表示されたら、**[OK]** を選んで、**origin/main** との間でコミットをプッシュおよびプルします。

   > **注**:段階的な変更のみがコミットされたため、他の変更は同期が保留されていることに注意してください。

## 履歴を確認する

Git は、各コミットに保存されている親参照情報を使用して、開発の完全な履歴を管理します。 このコミット履歴を簡単に確認して、ファイルの変更がいつ行われたかを確認し、ターミナルを使用して、または利用可能な多くの Visual Studio Code 拡張機能の 1 つからコードのバージョン間の違いを判断できます。 Azure DevOps ポータルを使用して変更を確認することもできます。

Git による**ブランチとマージ**機能の使用はプル要求を介して機能するため、開発のコミット履歴は必ずしも直線的な時系列を形成するとは限りません。 履歴を使用してバージョンを比較するときは、2 つの時点間のファイルの変更ではなく、2 つのコミット間のファイルの変更の観点から考えてください。 マスター ブランチ内のファイルに対する最近の変更は、前日にマージされた機能ブランチで 2 週間前に作成されたコミットに起因している可能性があります。

### ファイルの比較

1. Visual Studio Code ウィンドウの **[ソース管理]** タブを開いた状態で、ファイルのステージングされていないバージョンを表す **Constants.cs** を選びます。

   ![ファイル比較のスクリーンショット。](media/file-comparison.png)

   > **注**:比較ビューが開かれ、行った変更を簡単に見つけることができます。 この場合、それはただ 1 つのコメントです。

1. **Azure DevOps** ポータルの **[コミット]** ペインを表示している Web ブラウザー ウィンドウに切り替えて、ソース ブランチとマージを確認します。 これらは、ソースにいつどのように変更が加えられたかを視覚化するための便利な方法を提供します。
1. **[担当のコミット]** エントリまで下にスクロールし、その上にマウス ポインターを置くと、右側に省略記号が表示されます。
1. 省略記号を選び、ドロップダウン メニューで **[ファイルの参照]** を選んで結果を確認します。

   ![コミット参照のスクリーンショット。](media/commit-browse.png)

   > **注**:このビューは、コミットに対応するソースの状態を表し、各ソースファイルを確認してダウンロードできるようにします。

## ブランチの操作

Azure DevOps ポータルの **Azure リポジトリ**の**ブランチ** ビューから、Azure DevOps Git リポジトリを管理できます。 ビューをカスタマイズして、最も関心のあるブランチを追跡することもできるため、チームによって行われた変更を常に把握できます。

ブランチへの変更をコミットしても他のブランチには影響せず、変更をメインプロジェクトにマージしなくても、ブランチを他のブランチと共有できます。 また、新しいブランチを作成して、機能の変更やバグの修正をメイン ブランチやその他の作業から分離することもできます。 ブランチは軽量であるため、ブランチ間の切り替えはすばやく簡単です。 Git は、ブランチを操作するときにソースの複数のコピーを作成するのではなく、コミットに保存されている履歴情報を使用して、ブランチでの作業を開始するときにファイルを再作成します。 Git ワークフローでは、機能とバグ修正を管理するためのブランチを作成して使用する必要があります。 コードの共有やプル要求を使用したコードのレビューなど、Git ワークフローの残りの部分は、すべてブランチを介して機能します。 ブランチ内の作業を分離すると、現在のブランチを変更するだけで、作業内容を非常に簡単に変更できます。

### ローカル リポジトリに新しいブランチを作成する

1. ラボ コンピューターで実行されている **Visual Studio Code** に切り替えます。
1. Visual Studio Code ウィンドウの左下隅にある **[ソース管理]** タブを選んで、**[メイン]** を選びます。
1. ポップアップ ウィンドウで、**[+ ... から新しいブランチを作成する]** を選択します。

   ![[ブランチの作成] オプションのスクリーンショット。](media/create-branch.png)

1. **[ブランチの作成元 ref を選択]** テキストボックスで、参照ブランチとして **main** を選びます。
1. **[ブランチ名]** テキスト ボックスに **`dev`** と入力して新しいブランチを指定し、**Enter** キーを押します。

   > **注**:この時点で、自動的に **dev** ブランチに切り替わります。

### ブランチの削除

Git は、作業中のブランチを追跡し、ブランチをチェックアウトするときに、ファイルがそのブランチでの最新のコミットと一致することを確認します。 ブランチを使用すると、同じローカル Git リポジトリ内の複数のバージョンのソース コードを同時に操作できます。 Visual Studio Code を使用して、ブランチを公開、チェックアウト、および削除できます。

1. **Visual Studio Code** ウィンドウで **[ソース管理]** タブを選び、Visual Studio Code ウィンドウの左下隅にある **[変更の公開]** アイコン (新しく作成したブランチを表す **dev** ラベルのすぐ右側) を選びます。
1. **Azure DevOps** ポータルの **[コミット]** ペインを表示している Web ブラウザーウィンドウに切り替えて、**[ブランチ]** を選択します。
1. **[ブランチ]** ペインの **[マイニング]** タブで、ブランチのリストに **dev** が含まれていることを確認します。
1. マウス ポインタを **dev** ブランチ エントリに合わせると、右側に省略記号が表示されます。
1. 省略記号を選び、ポップアップ メニューで **[ブランチの削除]** を選んで、確認を求められたら **[削除]** を選びます。

   ![[ブランチの削除] オプションのスクリーンショット。](media/delete-branch.png)

1. **Visual Studio Code** ウィンドウに戻り、**[ソース管理]** タブを選んで、Visual Studio Code ウィンドウの左下隅にある **dev** エントリを選びます。 これにより、Visual Studio Code ウィンドウの上部に既存のブランチが表示されます。
1. 2 つの **dev** ブランチがリストされていることを確認します。
1. **[ブランチ]** の **[自分のもの]** タブが表示されている Web ブラウザーに移動します。
1. **[ブランチ]** ペインの **[マイニング]** タブで、 **[すべて]** タブを選択します。
1. **[ブランチ]** ペインの **[すべて]** タブの **[ブランチ名の検索]** テキスト ボックスに「**`dev`**」と入力します。
1. 新しく削除されたブランチを表すエントリを含む **[削除されたブランチ]** セクションを確認します。
1. **[削除されたブランチ]** セクションで、マウス ポインターを **dev** ブランチ エントリに合わせると、右側に省略記号が表示されます。
1. 省略記号を選び、ポップアップ メニューで **[ブランチの復元]** を選びます。

   ![[ブランチの復元] オプションのスクリーンショット](media/restore-branch.png)

   > **注**:正確な名前がわかっている限り、この機能を使用して、削除されたブランチを復元できます。

### ブランチ ポリシー

Azure DevOps ポータルを使って、メイン ブランチにポリシーを追加し、定義したポリシーに準拠する pull request を使った変更のみを許可します。 ブランチの変更を確認してから、マージする必要があります。

わかりやすくするために、(元のシナリオで推奨されていたように) VS コードでローカル クローンを使うのではなく、Web ブラウザーのリポジトリ エディターで直接作業します (origin で直接作業します)。

1. Azure DevOps ポータルの **[ブランチ]** ペインの **[マイニング]** タブを表示している Web ブラウザーに切り替えます。
1. **[ブランチ]** ペインの **[マイニング]** タブで、**main** ブランチ エントリにマウス ポインターを合わせると、右側に省略記号が表示されます。
1. 省略記号を選び、ポップアップ メニューで **[ブランチ ポリシー]** を選びます。

   ![[ブランチ ポリシー] オプションのスクリーンショット](media/branch-policies.png)

1. リポジトリ設定の **[main]** タブで、 **[Require minimum number of reviewers] (レビュー担当者の最小数を必須にする)** のオプションを有効にします。 **1** 人のレビュー担当者を追加し、 **[Allow requestors to approve their own changes] (要求者が自分の変更を承認することを許可する)** チェック ボックスをオンにします (このラボのプロジェクトでは、自分が唯一のユーザーであるため)
1. リポジトリ設定の **[main]** タブで、 **[Check for linked work items] (リンクされた作業項目を確認する)** のオプションを有効にし、 **[必要]** オプションのままにします。

   ![ポリシー設定のスクリーンショット。](media/policy-settings.png)

### ブランチ ポリシーのテスト

1. Azure DevOps ポータルの縦型ナビゲーション ペインの **[リポジトリ] > [ファイル]** で、**メイン** ブランチが選ばれていることを確認します (表示されているコンテンツの上のドロップダウン)。
1. ポリシーが機能していることを確認するには、**main** ブランチに変更を加えてコミットし、 **/eShopOnWeb/src/Web/Program.cs** ファイルに移動して選びます。 これにより、コンテンツが詳細ペインに自動的に表示されます。
1. 最初の行に次のコメントを追加します。

   ```csharp
   // Testing main branch policy
   ```

1. **[コミット] > [コミット]** を選びます。 "changes to the main branch can only be done using a Pull Request" (main ブランチを変更するには pull request を使用する必要があります) という警告が表示されます。

   ![コミットが拒否されたポリシーのスクリーンショット。](media/policy-denied.png)

1. **[キャンセル]** を選んでコミットをスキップします。

### pull request の操作

Azure DevOps ポータルを使い、**dev** ブランチを使って保護された**メイン** ブランチに変更をマージする pull request を作成します。 Code アクティビティで保留中の作業を追跡できるように、Azure DevOps の作業項目が変更にリンクされます。

1. Azure DevOps ポータルの縦型ナビゲーション ペインの **[ボード]** セクションで、**[作業項目]** を選びます。
1. **[+ 新しい作業項目] > [プロダクト バックログ項目]** を選びます。 タイトル フィールドに「**最初の PR のテスト**」と入力して、**[保存]** を選びます。
1. Azure DevOps ポータルの縦型ナビゲーション ペインに戻り、**[リポジトリ] > [ファイル]** で **dev** ブランチが選ばれていることを確認します。
1. **/eShopOnWeb/src/Web/Program.cs** ファイルに移動し、最初の行に次の変更を加えます。

   ```csharp
   // Testing my first PR
   ```

1. **[コミット] > [コミット]** を選びます (既定のコミット メッセージのままにします)。 今回はコミットが機能し、**dev** ブランチにポリシーはありません。
1. メッセージがポップアップ表示され、pull request を作成するように提案されます (**dev** ブランチは **main** と比較して変更が進んでいるため)。 **[pull request の作成]** を選びます。

   ![[pull request の作成] オプションのスクリーンショット。](media/create-pr.png)

1. **[新しい pull request ]** タブで、既定値のままにして **[作成]** を選びます。
1. pull request には、ターゲットの **main** ブランチに適用されているポリシーに基づいて、失敗した、または保留中の要求がいくつか表示されます。

   - 提案される変更には、おそらく作業項目がリンクされています
   - 少なくとも 1 人のユーザーが変更を確認し、承認する必要があります。

1. 右側のオプションで **[作業項目]** の横の **+** ボタンを選びます。 先ほど作成した作業項目を選んで pull request にリンクします。 要件の 1 つの状態が変わったことを確認できます。

   ![作業項目のリンクのスクリーンショット。](media/link-wit.png)

1. 次に、 **[ファイル]** タブを開いて、提案された変更を確認します。 より完全な pull request では、ファイルを 1 つずつ確認し (レビュー済みとマーク)、明確でない行に対してコメントを開くことができます (行番号にマウスを置くと、コメントを投稿するオプションが表示されます)。
1. **[概要]** タブに戻り、右上隅の **[承認]** を選びます。 すべての要件が緑色に変わります。 **[完了]** を選べるようになります。
1. **[プル要求の完了]** タブでは、マージを完了する前に複数のオプションが表示されます。

   - **マージの種類**: 4 つのマージの種類があります。[ここ](https://learn.microsoft.com/azure/devops/repos/git/complete-pull-requests?view=azure-devops&tabs=browser#complete-a-pull-request)を確認するか、用意されているアニメーションを見ることができます。 **[マージ (早送りなし)]** を選びます。
   - **完了後のオプション**:
     - **[関連付けられた作業項目をマージ後に完了する]** をオンにします。これで、関連付けられた PBI が "**完了**" 状態になります。

1. **[マージの完了]** を選びます

### タグの適用

製品チームは、サイトの現在のバージョンを v1.1.0-beta としてリリースすることを決定しました。

1. Azure DevOps ポータルの縦型ナビゲーション ペインで、**[リポジトリ]** セクションの **[タグ]** を選びます。
1. **[タグ]** ペインで、**[新しいタグ]** を選びます。
1. **[タグの作成]** パネルで、**[名前]** テキスト ボックスに「**`v1.1.0-beta`**」と入力し、**[ベース]** ドロップダウン リストで **[メイン]** エントリを選んだままにし、**[説明]** テキスト ボックスに「**`Beta release v1.1.0`**」と入力して、**[作成]** を選びます。

   > **注**: このリリースのリポジトリにタグを付ける作業はこれで完了です (最新のコミットがタグにリンクされます)。 さまざまな理由でコミットにタグを付けることができます。Azure DevOps は、コミットを編集および削除したり、アクセス許可を管理したりする柔軟性を提供します。

## ブランチ ポリシーを削除する

表示されている順に別のコース ラボで内容を確認するときに、このラボで構成されたブランチ ポリシーによって、将来のラボのエクササイズがブロックされます。 そのため、構成されたブランチ ポリシーを削除する必要があります。

1. Azure DevOps **eShopOnWeb** プロジェクト ビューで、**[リポジトリ]** に移動し、**[ブランチ]** を選びます。 **[ブランチ]** ペインの **[マイニング]** タブを選択します。
1. **[ブランチ]** ペインの **[マイニング]** タブで、**main** ブランチ エントリにマウス ポインターを合わせると、右側に省略記号 (...) が表示されます。
1. 省略記号を選び、ポップアップ メニューで **[ブランチ ポリシー]** を選びます。
1. リポジトリ設定の **[main]** タブで、**[Require minimum number of reviewers] (レビュー担当者の最小数を必須にする)** のオプションを無効にします。
1. リポジトリ設定の **[main]** タブで、**[リンクされた作業項目を確認します]** のオプションを無効にします。
1. これで、メイン ブランチのブランチ ポリシーが無効化または削除されました。

## リソースをクリーンアップする

Azure DevOps 組織またはプロジェクトは参照およびポートフォリオ アイテムとして引き続き使用できるので、これらをクリーンアップする必要はありません。 Azure DevOps では、小規模なチーム向けの基本的な機能を含む Free レベルを使用できます。

プロジェクトを削除したい場合は、次の手順に従って行えます。

1. ブラウザーで Azure DevOps ポータル (`https://aex.dev.azure.com`) に移動します。
1. 作成した **eShopOnWeb** プロジェクトに移動します。
1. プロジェクト設定ページで **[概要]** に移動し、ページの下部にある **[削除]** を選びます。
1. プロジェクト名を入力して削除を確認し、**[削除]** を選びます。

> **注:** プロジェクトを削除すると、すべての作業項目、リポジトリ、ビルド、その他のプロジェクト成果物が削除されます。 この演習用に既存のプロジェクトを使った場合は、この演習の範囲外にある既存のリソースも削除されます。
